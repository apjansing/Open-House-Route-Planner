%
% Elizabeth Wilcox
% MAT 373: Number Theory
%
\documentclass[11 pt]{article}
% \documentclass[11 pt]{IEEEtran}

%  packages
\usepackage{amssymb, amsmath, amsthm, enumerate, graphicx, multirow, float, color, xcolor}
\usepackage{tikz, standalone}
\usepackage{hyperref}
\usetikzlibrary{arrows}
\usetikzlibrary{graphs,quotes}

%  margins
\textwidth = 6.5 in 
\textheight = 9 in
\oddsidemargin = 0.0 in 
\evensidemargin = 0.0 in 
\topmargin = 0.0 in 
\headheight = 0.0 in
\headsep = 0.0 in 

%  theorems, corollaries, etc.
\theoremstyle{definition}
\newtheorem{thm}{Theorem}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}

\theoremstyle{definition}
\newtheorem*{example}{Example}
\newtheorem{dfn}[thm]{Definition}

\renewcommand{\qedsymbol}{\vrule height 5pt width 4pt depth -1pt}

% spacing shortcuts
\def\skip{\vspace{10 pt}}
\def\medskip{\vspace{15 pt}}

% text shortcuts
\def\ie{{i.e.,}\ }
\def\eg{{e.g.,}\ }
\def\bbar#1{\overline{#1}}

%  set shortcuts
% \def\QQ{\mathbb{Q}}
% \def\ZZ{\mathbb{Z}}
% \def\RR{\mathbb{R}}
% \def\CC{\mathbb{C}}
% \def\NN{\mathbb{N}}
\def\ket#1{\big|{#1}\big>}
\def\bra#1{\big<{#1}\big|}

\def\red#1{\textcolor{red}{#1}}
% \def\br{\beta-reduction}
% \def\ar{\alpha-reduction}
% \def\er{\eta-reduction}

% number theory shortcuts
\def\divides{\big |}
\def\gcd#1#2{\textrm{gcd}({#1},{#2})}
\def\ord#1{|{#1}|}

% logic shortcuts
\def\iff{\Leftrightarrow}
\thispagestyle{empty}

% standard math packages
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{scrextend}
\usepackage{tikz}
\usetikzlibrary{arrows, shapes, plothandlers}
\usepackage{tikz}
\usepackage{tikzscale}
\usepackage{ragged2e}

\usepackage{hyperref}
\usepackage{url}
\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother


\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breakatwhitespace=true,
  tabsize=3,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}


% Phil Parker's DGS packages, some modified
\usepackage{remexpp,pprroof,dgstpp}

% other packages
\usepackage{setspace}
%\usepackage{hyperref,color}

% "fancy" font
\usepackage{fourier}
\usepackage[T1]{fontenc}
   
% make reference header the right font size
\renewcommand\refname{\Large References}
   
% theorems, remarks, etc using Phil Parker's "remexpp.sty"
% \newtheorem{theorem}{Theorem}[section]
% \newtheorem{prop}[theorem]{Proposition}
% \newtheorem{lemma}[theorem]{Lemma}
% \newtheorem{claim}[theorem]{Claim}
% \newtheorem{corollary}[theorem]{Corollary}
% \newremark{definition}[theorem]{Definition}
% \newremark{example}[theorem]{Example}
% \newremark{remark}[theorem]{Remark} 

% make rsfs, TeX \cal, and Euler script *all* available
\usepackage{mathrsfs}
\let\rscr=\mathscr
\let\mathscr=\relax
\let\mcal=\mathcal
\usepackage{eucal}
\let\escr=\mathcal
\let\mathcal=\relax

% commutative diagrams with XY-pic
\usepackage[all]{xy}
\SelectTips{cm}{}

\arraycolsep .2em
   
% new commands
\renewcommand{\a}{\alpha}
\newcommand{\Aut}[1]{\textrm{Aut}(#1)}
\newcommand{\B}{\rscr{B}}
\newcommand{\br}[2]{\left[#1,#2\right]}
\newcommand{\bre}{\br{\ }{\,}}
\newcommand{\ddg}{\ddot{\g}}
\newcommand{\dg}{\dot{\g}}
\newcommand{\DGS}{D{\kern-.375em}G{\kern-.2em}S}
\newcommand{\ds}{\oplus}
\newcommand{\eB}{\escr{B}}
\newcommand{\eH}{\escr{H}}
\newcommand{\eI}{\escr{I}}
\newcommand{\eV}{\escr{V}}
\newcommand{\g}{\gamma}
\newcommand{\G}{\Gamma}
\newcommand{\h}{\lal{h}}
\renewcommand{\H}{\rscr{H}}
\newcommand{\hp}{\h_{2p + 1}}
\newcommand{\iso}{\cong}
\newcommand{\lag}{\mathfrak{g}}
\newcommand{\lal}[1]{\mathfrak{#1}}
\newcommand{\n}{\lal{n}}
\newcommand{\pplus}{+\mspace{-10 mu}+}
\newcommand{\R}{\mathbb{R}}
\newcommand{\rS}{\rscr{S}}
\renewcommand{\span}[1]{[\mspace{-3.25 mu}[ #1 ]\mspace{-3.25 mu}]}
\newcommand{\surj}{\rightarrow\kern-.82em\rightarrow}
\newcommand{\tQ}{\widetilde{Q}}
\renewcommand{\v}{\lal{v}}
\newcommand{\V}{\rscr{V}}
\newcommand{\z}{\lal{z}}
%%Alex's defined commands%%
\newcommand{\adx}{ad$_x$ }
\newcommand{\ady}{ad$_y$ }
\newcommand{\adz}{ad$_z$ }
\newcommand{\fj}{\mathfrak{j}}
\newcommand{\fg}{\mathfrak{g}}
\newcommand{\fz}{\mathfrak{z}}
\newcommand{\fv}{\mathfrak{v}}
\newcommand{\fh}{\mathfrak{h}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\FF}{\mathbb{F}}


\makeatletter
\newcommand{\ad}[1]{\mathop{\operator@font ad}\nolimits_{#1}}
\makeatother

% show labels in margin (must be last package added)
% \usepackage{showlabels}

% input information for the title page here:
\preprint{}
\title{Open House Route Planner}
\author{Alexander Jansing}
\address{
   Computer Science Department\\
   State University of New York,\\
   Polytechnic Institute\\
   Utica, NY 13502\\
   USA\\
   \textsf{jansina@sunypoly.edu}
}
\date{\today}
\abstract{
Consectetur sit aliquip pariatur anim et proident nisi mollit labore exercitation sunt exercitation fugiat.
}
\msc{}{}
\begin{document}
\maketitle
%%%%%%%%%SECTION%%%%%%%%%

\section{Introduction}
\subsection{Motivation}
I have been looking for houses. When I add open houses to my Google Calendar, I am able to request direction to whatever house is open next in time, but I was thinking

Over the last year, I had been looking for a house and was trying to visit as many open houses as I could. So the question became, \emph{``What if two houses are significantly far apart, open at similar times, and there are other houses in each of their respective neighborhoods that open at different times? Is there a way I can plan my day of house hunting so that I can attend all of the open houses?''} The answer to this question is, ``yes, within reason.''

\subsection{Objective}
Given a series of open houses the application should find routes that will allow the user to visit the maximum number of open houses given the constraints of \emph{travel time} and \emph{when the open houses are open}.

After phrasing stating the problem, the problem was divided up into several part:
\begin{itemize}
  \item where the houses were with respect to each other,
  \item when the open houses were,
  \item and try to determine the path I needed to take to visit as many open houses as possible.
\end{itemize}

I will describe how each of these tasks were accomplished and what other work needed to be done to facilitate that work.

%%%%%%%%%SECTION%%%%%%%%%

\section{Requirements}
As with most projects, a bit of legwork is involved before even starting the main problem. Before routes can be derived from the data, we need to know
\begin{itemize}
  \item what kind of data the system will accept,
  \item what kind of ETL (Extraction, Transformation, and Loading) processes will need to occur,
  \item if/how there data will be cached,
  \item what infrastructure can we set up to support these requirements,
  \item and how might we will we compute routes?
\end{itemize}

\subsection{ETL}
As for the first three points, the following describe what kind of data the program accepts, its transformation, and how there data is cached.

\subsubsection{Extraction}\label{E}
Data extraction was performed manually as it seems that many realestate sites did not want to hand over data programatically; or if they did the purchase of an API key was required. The data used for this project was sourced from Trulia\cite{Trulia} in the form of ICS files\cite{ICS}.

\subsubsection{Transformation}\label{T}
Open House data is typically provided with in a human readable format with an address written like ``100 Seymour Ave, Utica, NY 13502'' and times provided in the form "10AM to 12PM." These forms of data need to be handled somehow. Luckily, when downloading calendar data the time data comes in ISO 8601 Notation (\emph{\ie} yyyymmddThhmmssZ).

That just leaves the address to be \emph{geocoded}; the process of converting addresses to a coordinate system. The ArcGIS Developer API provides an easy way to geocode address data. This process will be described in the section \ref{geocoding} along with all the other transformations required to consistently gather and use data.
 
\subsubsection{Loading}\label{L}
To avoid having to query the ArcGIS API repeated and spending the credits that was required\cite{ArcGIS}, the data is stored in a MongoDB instance. This not only helps the program be more economically efficient, but cuts down on latency during testing and future delivery.

\subsection{Infrastructure}
Docker is a modern technology that helps facilitate rapid prototyping, development, and compartmentalization of development of projects \cite{DOCKER}. Docker, and subsequently docker-compose\cite{DC}, was used on this project to set up network on systems that could easily be deployed on a cloud service. 

This docker-compose network consisted of three containers to query ArcGIS API, store geocoded data, and perform computation on graph data structure; esri, mongo, and routefinder, respectively (see Figure \ref{docker-compose-network-diagram} and Appendix \ref{docker-images}).
\begin{figure}
\begin{center}
    \includestandalone[width=10cm]{tikz/docker-compose}
    \caption{Docker-compose network diagram.}\label{docker-compose-network-diagram}
  \end{center}
\end{figure}


\subsection{Computation}

When the project was started, it was thought that Spark could be used to perform graph processing\cite{SPARK}. Later on, it was decided that the graphs were not going to be large enough to have to worry about optimizing the processing. A graph data structure was still used for handing the data when the time came to computing routes\cite{Agarwal}. The vertices were given IDs, addresses, start and end times, and edges with weights.

%%%%%%%%%SECTION%%%%%%%%%
\section{Preprocessing}

\subsection{Geocoding} \label{geocoding}
Given a directory holding $n$ ICS files downloaded from Trulia, as per section \ref{E}, the data is parsed by the ICSParser (\ref{code}) and the address information is \emph{safely geocoded} (querying for existence in MongoDB, otherwise querying ArcGIS API for information) by MongoOps and a Flask REST endpoint \cite{Flask}.


%%%%%%%%%SECTION%%%%%%%%%

%%%%%%%%%SECTION%%%%%%%%%

\newpage
\section{Appendix}
\subsection{Resources}
\subsubsection{Docker Images}\label{docker-images}
\begin{itemize}
  \item \href{https://hub.docker.com/r/jupyter/pyspark-notebook}{jupyter/pyspark-notebook:7254cdcfa22b}\cite{img-pyspark} - container renamed \emph{routefinder}.
  \item \href{https://hub.docker.com/r/esridocker/arcgis-api-python-notebook}{esridocker/arcgis-api-python-notebook:1.5}\cite{img-esri} - container renamed \emph{esri}.
  \item \href{https://hub.docker.com/_/mongo}{mongo:4.1}\cite{img-mongo} - container named \emph{mongo}.
\end{itemize}

\subsection{Code}\label{code}
\begin{itemize}
  \item \href{https://github.com/apjansing/Open-House-Route-Planner}{apjansing/Open-House-Route-Planner} - This project.
  \begin{itemize}
    \item \href{https://github.com/apjansing/Open-House-Route-Planner/blob/master/backend/docker/persistence/pyspark/ICSParser.py}{ICSParser} - Class for parsing ICS files.
    \item \href{https://github.com/apjansing/Open-House-Route-Planner/blob/master/backend/docker/persistence/pyspark/MongoOps.py}{MongoOps} - Class for:
    \begin{itemize}
      \item loading data to database, 
      \item querying the database for geocoded address,
      \item querying the database for directions,
      \item querying the ArcGIS Developer API for geocoded address,
      \item and querying the ArcGIS Developer API for directions.
    \end{itemize}
    \item \href{https://github.com/apjansing/Open-House-Route-Planner/blob/master/backend/docker/persistence/pyspark/make_directions_matrix.py}{DirectionsMatrix} - Class for creating a matrix of directions data pertaining to locations passed to it. It utilized the MongoOps class to safely query for directions between open houses.
    \item \href{https://github.com/apjansing/Open-House-Route-Planner/blob/master/backend/docker/persistence/pyspark/OpenHouseGraph.py}{OpenHouseGraph} - A graph data structure used for computing routes one might take while visiting open houses.
    \item \href{https://github.com/apjansing/Open-House-Route-Planner/blob/master/backend/docker/persistence/esri/esri_flask.py}{Esri Flask App} - REST endpoint that is designed to accept information from MongoOps and query the ArcGIS Developer API for geocoded address information or directions between two GeoJSON Points.
  \end{itemize}
  \item \href{https://towardsdatascience.com/to-all-data-scientists-the-one-graph-algorithm-you-need-to-know-59178dbb1ec2}{Data Scientists, The one Graph Algorithm you need to know}\cite{Agarwal} - Basis for the OpenHouseGraph class.
\end{itemize}

%%%%%%%%%SECTION%%%%%%%%%

\begin{thebibliography}{99}
  
\bibitem{Agarwal}
Agarwal, R. (2019). To all Data Scientists - The one Graph Algorithm you need to know. [online] Towards Data Science. Available at: \url{https://towardsdatascience.com/to-all-data-scientists-the-one-graph-algorithm-you-need-to-know-59178dbb1ec2} [Accessed 13 Apr. 2019].

\bibitem{PYArcGIS}
ArcGIS for Developers. (2019). ArcGIS API for Python | ArcGIS for Developers. [online] Available at: \url{https://
developers.arcgis.com/python/} [Accessed 13 Apr. 2019].

\bibitem{ArcGIS}
ArcGIS for Developers. (2019). ArcGIS for Developers. [online] Available at: \url{https://developers.arcgis.com/} [Accessed 13 Apr. 2019].

\bibitem{ICS}
Wikiwand. (2019). iCalendar | Wikiwand. [online] Available at: \url{https://www.wikiwand.com/en/ICalendar} [Accessed 13 Apr. 2019].
  
\bibitem{DOCKER}
Docker Documentation. (2019). About Docker CE. [online] Available at: \url{https://docs.docker.com/install/} [Accessed 13 Apr. 2019].

\bibitem{DC}
Docker Documentation. (2019). Install Docker Compose. [online] Available at: \url{https://docs.docker.com/compose/install/} [Accessed 13 Apr. 2019].
  
\bibitem{SPARK}
Spark.apache.org. (2019). GraphX | Apache Spark. [online] Available at: \url{https://spark.apache.org/graphx/} [Accessed 13 Apr. 2019].

\bibitem{Flask}
Flask.pocoo.org. (2019). Welcome | Flask (A Python Microframework). [online] Available at: \url{http://flask.pocoo.org/} [Accessed 14 Apr. 2019].

\bibitem{Trulia}
Trulia. (2019). Trulia: Real Estate Listings, Homes for Sale, Housing Data. [online] Available at: \url{https://www.trulia.com/} [Accessed 13 Apr. 2019].


\bibitem{img-pyspark}
jupyter/pyspark-notebook. (2019). \url{https://hub.docker.com/r/jupyter/pyspark-notebook}: MongoDB.

\bibitem{img-esri}
esridocker/arcgis-api-python-notebook. (2019). \url{https://hub.docker.com/r/esridocker/arcgis-api-python-notebook}: MongoDB.

\bibitem{img-mongo}
mongo. (2019). \url{https://hub.docker.com/_/mongo}: MongoDB.

\end{thebibliography}
\end{document}






















