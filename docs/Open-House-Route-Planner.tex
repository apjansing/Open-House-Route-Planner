% This is an example manuscript for the SUNY Poly style options
%       sunypoly_ms.sty (Masters Thesis)

\documentclass[letterpaper,11pt]{report}
\usepackage{sunypolyms}       % For Master's papers
\usepackage{ulem}       % underlining on style-page; see \normalem below
\usepackage{url}	% support for hyperlinks, especially in bibliography
%  packages
\usepackage{amssymb, amsmath, amsthm, enumerate, graphicx, multirow, float, color, xcolor}
\usepackage{tikz, standalone}
\usetikzlibrary{arrows}
\usetikzlibrary{graphs,quotes, positioning}
\usepackage[hidelinks]{hyperref}
\hypersetup{breaklinks=true}
\urlstyle{same}
\usepackage{cite}

%  theorems, corollaries, etc.
\theoremstyle{definition}
\newtheorem{thm}{Theorem}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}

\theoremstyle{definition}
\newtheorem*{example}{Example}
\newtheorem{dfn}[thm]{Definition}

\renewcommand{\qedsymbol}{\vrule height 5pt width 4pt depth -1pt}

% spacing shortcuts
\def\skip{\vspace{10 pt}}
\def\medskip{\vspace{15 pt}}

% text shortcuts
\def\ie{{i.e.,}\ }
\def\eg{{e.g.,}\ }
\def\bbar#1{\overline{#1}}

%  set shortcuts
\def\ket#1{\big|{#1}\big>}
\def\bra#1{\big<{#1}\big|}

\def\red#1{\textcolor{red}{#1}}

% number theory shortcuts
\def\divides{\big |}
\def\gcd#1#2{\textrm{gcd}({#1},{#2})}
\def\ord#1{|{#1}|}

% logic shortcuts
\def\iff{\Leftrightarrow}
\thispagestyle{empty}

% standard math packages
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{scrextend}
\usepackage{tikz}
\usetikzlibrary{arrows, shapes, plothandlers}
\usepackage{tikz}
\usepackage{tikzscale}
\usepackage{ragged2e}

\usepackage{hyperref}
\usepackage{url}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}

\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother

% Another Code Snippet displayer used to colorize yml properly
% UNCOMMENT WHEN BEFORE COMMITTING OR PRINTING
\usepackage{minted}

\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\scriptsize\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breakatwhitespace=true,
  tabsize=3,
  breaklines=true,
  literate={\-}{}{0\discretionary{-}{}{-}},
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}

% Phil Parker's DGS packages, some modified
% \usepackage{remexpp,pprroof,dgstpp}

% other packages
\usepackage{setspace}
%\usepackage{hyperref,color}

% "fancy" font
\usepackage{fourier}
\usepackage[T1]{fontenc}
   
% make reference header the right font size
% \renewcommand\refname{\Large References}
   
% theorems, remarks, etc using Phil Parker's "remexpp.sty"
% \newtheorem{theorem}{Theorem}[section]
% \newtheorem{prop}[theorem]{Proposition}
% \newtheorem{lemma}[theorem]{Lemma}
% \newtheorem{claim}[theorem]{Claim}
% \newtheorem{corollary}[theorem]{Corollary}
% \newremark{definition}[theorem]{Definition}
% \newremark{example}[theorem]{Example}
% \newremark{remark}[theorem]{Remark} 

% make rsfs, TeX \cal, and Euler script *all* available
\usepackage{mathrsfs}
\let\rscr=\mathscr
\let\mathscr=\relax
\let\mcal=\mathcal
\usepackage{eucal}
\let\escr=\mathcal
\let\mathcal=\relax

% commutative diagrams with XY-pic
\usepackage[all]{xy}
\SelectTips{cm}{}

\arraycolsep .2em
   
% new commands
\renewcommand{\a}{\alpha}
\newcommand{\Aut}[1]{\textrm{Aut}(#1)}
\newcommand{\B}{\rscr{B}}
\newcommand{\br}[2]{\left[#1,#2\right]}
\newcommand{\bre}{\br{\ }{\,}}
\newcommand{\ddg}{\ddot{\g}}
\newcommand{\dg}{\dot{\g}}
\newcommand{\DGS}{D{\kern-.375em}G{\kern-.2em}S}
\newcommand{\ds}{\oplus}
\newcommand{\eB}{\escr{B}}
\newcommand{\eH}{\escr{H}}
\newcommand{\eI}{\escr{I}}
\newcommand{\eV}{\escr{V}}
\newcommand{\g}{\gamma}
\newcommand{\G}{\Gamma}
\newcommand{\h}{\lal{h}}
\renewcommand{\H}{\rscr{H}}
\newcommand{\hp}{\h_{2p + 1}}
\newcommand{\iso}{\cong}
\newcommand{\lag}{\mathfrak{g}}
\newcommand{\lal}[1]{\mathfrak{#1}}
\newcommand{\n}{\lal{n}}
\newcommand{\pplus}{+\mspace{-10 mu}+}
\newcommand{\R}{\mathbb{R}}
\newcommand{\rS}{\rscr{S}}
\renewcommand{\span}[1]{[\mspace{-3.25 mu}[ #1 ]\mspace{-3.25 mu}]}
\newcommand{\surj}{\rightarrow\kern-.82em\rightarrow}
\newcommand{\tQ}{\widetilde{Q}}
\renewcommand{\v}{\lal{v}}
\newcommand{\V}{\rscr{V}}
\newcommand{\z}{\lal{z}}
%%Alex's defined commands%%
\newcommand{\adx}{ad$_x$ }
\newcommand{\ady}{ad$_y$ }
\newcommand{\adz}{ad$_z$ }
\newcommand{\fj}{\mathfrak{j}}
\newcommand{\fg}{\mathfrak{g}}
\newcommand{\fz}{\mathfrak{z}}
\newcommand{\fv}{\mathfrak{v}}
\newcommand{\fh}{\mathfrak{h}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\FF}{\mathbb{F}}



% Adjust placement of text frame to match your software and hardware.
% Usually 1.5in on left, 1in on right and bottom.  You may not need
% to uncomment this section.  Home printing systems are notorious for
% incorrectly placed margins due to paper loading and/or slipping
% problems
%
%\addtolength{\oddsidemargin}{.2in}
%    \setlength{\evensidemargin}{\oddsidemargin}
%\addtolength{\topmargin}{-.1in}


% May want theorems numbered by chapter
\newtheorem{theorem}{Theorem}[chapter]

% Put the title, author, and date in. 
\title{Open House Route Planner}
\author{Alexander Jansing}
\date{\today} % date is the date of graduation

% List previous degrees here, one \previousdegree for each degree.
%\previousdegree{M.A., University of Nebraska--Lincoln, 1984}
\previousdegree{B.S., SUNY Oswego, 2015}

% Put the Thesis Adviser here. 
\advisor{Jorge Novillo}


% Put the committee here (including the adviser), one \professor for each. 
% The advisor must be SECOND!!!, and the dean must be LAST!!!.
\professor{PLACEHOLDER\\
Professor\\
Department of Computer Science}

\professor{Jorge Novillo\\
Professor \\
Department of Computer Science}

\professor{PLACEHOLDER\\
Professor \\
Department of Computer Science}

\professor{PLACEHOLDER\\
Dean\\
College of Engineering}



% Information for style-page
% Note: Due to the way underlining is handled, any "extra" braces here will
% create a box which cannot be broken across lines. The \style argument below
% shows how emphasis should be done.

\style{Journal of Approximation Theory (together with the style known as
``sunypolyms'').  Bibliography follows van Leunen's {\it A} {\it Handbook}
{\it for} {\it Scholars}.}


\software{The document preparation package \TeX{} (specifically \LaTeX2e)
together with the style-file {\tt sunypolyms.sty}.}



\begin{document}

% Uncomment the "nocite" line to have all entries in your bibliography listed,
% regardless of whether they were cited.  This is often helpful in discovering
% you had not referenced a source you intended, especially if, like me,
% you add useful sources to your bibliography file as you discover them.  If
% you don't add sources to your bibliography until you write text that cites
% them, you may never need this line.
%
\nocite{*}

\begin{romanpages}      % roman-numbered pages 
    \ApprovalPage   % May comment-out until final version.
    \TitlePage 
    \CopyrightPage  % Should do nothing for Ph.D., if the degree is ever offered
    
    % This should be a paragraph-style history of your academic work and
    % industry efforts that may have contributed to your reaching this
    % stage in your academic career.  
    %
    % Note that this is a special chapter style that must begin and end 
    % the "vita" LaTeX environment.
    %
    \input{vita.tex}
    
    % This should be a very high level overview of the novel work presented
    % in your manuscript.  Experiments should be outlined with the utmost brevity
    % and only their most compelling results revealed.  Often the results
    % identified here will lack numeric values which are saved for the Introduction
    % chapter. 
    %
    % Note that this is a special chapter style that must begin and end 
    % the "abstract" LaTeX environment.
    %
    \input{abstract.tex}
    
    % Acknowledge and dedicate you work to whomever you wish.  It is common to
    % identify those who significantly advised your work by name and at least 
    % recognize your advisory committee as a whole.  This chapter is personal, 
    % however, so a simple "R.I.P. Johhny Cash" is completely acceptable.
    %
    % Note that this is a special chapter style that must begin and end 
    % the "acknowledgments" LaTeX environment.
    %
    \input{acknowledgments.tex}
    
    \StylePage
    \tableofcontents
    
    % comment either of the following lines should your manuscript contain no 
    % figures or tables
    %
    \listoffigures
    % \listoftables
    
\end{romanpages}        % All done with roman-numbered pages


\normalem       % Make italics the default for \em


% Introduction ((((( required! )))))
%
%\input{introduction.tex}

% Related work ((((( required! )))))
%
%\input{related_work.tex}

% Statement of the problem
%
%\input{problem.tex}

% How you attempted to solve the problem
%
%\input{solution.tex}

% Implementations of your solution
%
%\input{implementations.tex}

% How did you determine whether you solved the problem
%
%\input{experiments.tex}

% What ascpects of the problem did you solve or not solve? ((((( !REQUIRED! ))))) 
% What are the anticipated benefits of this? ((((( !REQUIRED! ))))) 
%
%\input{conclusions.tex}

% NEXT STEPS SHOULD SOMEONE CONTINUE THIS WORK ((((( required! )))))
%
%\include{future_work.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% REMOVE THIS SECTION WHEN PREPARING YOUR OWN MANUSCRIPT AND WRITE %
%          THE FILES NEEDED TO MEET THE ABOVE ORGANIZATION         % 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Open House Routing Planner}
\subsection{Motivation}
I have been looking for houses. When I add open houses to my Google Calendar, I am able to request direction to whatever house is open next in time, but I was thinking, \emph{``What if two houses are significantly far apart, open at similar times, and there are other houses in each of their respective neighborhoods that open at different times? Is there a way I can plan my day of house hunting so that I can attend all of the open houses?''} The answer to this question is, ``yes, within reason.''

\subsection{Objective}
Given a series of open houses the application should find routes that will allow the user to visit the maximum number of open houses given the constraints of \emph{travel time} and \emph{when the open houses are open}.

After stating the problem, it was divided up into several part:
\begin{itemize}
  \item where the houses were with respect to each other,
  \item when the open houses were,
  \item and try to determine the path I needed to take to visit as many open houses as possible.
\end{itemize}

I will describe how each of these tasks were accomplished and what other work needed to be done to facilitate that work.

%%%%%%%%%SECTION%%%%%%%%%

\section{Requirements}
As with most projects, a bit of legwork is involved before even starting the main problem. Before routes can be derived from the data, we need to know
\begin{itemize}
  \item what kind of data the system will accept,
  \item what kind of ETL (Extraction, Transformation, and Loading) processes will need to occur,
  \item if/how there data will be cached,
  \item what infrastructure can we set up to support these requirements,
  \item and how might we will we compute routes?
\end{itemize}

\subsection{ETL}
As for the first three points, the following describe what kind of data the program accepts, its transformation, and how there data is cached.

\subsubsection{Extraction}\label{E}
Data extraction was performed manually as it seems that many real estate sites did not want to hand over data programatically; or if they did the purchase of an API key was required. The data used for this project was sourced from Trulia\cite{Trulia} in the form of ICS files\cite{ICS}.

\subsubsection{Transformation}\label{T}
Open House data is typically provided with in a human readable format with an address written like ``100 Seymour Ave, Utica, NY 13502'' and times provided in the form "10AM to 12PM." These forms of data need to be handled somehow. Luckily, when downloading calendar data the time data comes in ISO 8601 Notation (\emph{\ie} yyyymmddThhmmssZ).

That just leaves the address to be \emph{geocoded}; the process of converting addresses to a coordinate system. The ArcGIS Developer API provides an easy way to geocode address data. This process will be described in the section \ref{preprocessing} along with all the other transformations required to consistently gather and use data.
 
\subsubsection{Loading}\label{L}
To avoid having to query the ArcGIS API repeated and spending the credits that was required\cite{ArcGIS}, the data is stored in a MongoDB instance. This not only helps the program be more economically efficient, but cuts down on latency during testing and future delivery.

\subsection{Infrastructure}
Docker is a container platform that helps facilitate rapid prototyping, development, and compartmentalization of development of projects \cite{DOCKER}. Docker, and subsequently docker-compose\cite{DC}, was used on this project to set up network on systems that could easily be deployed on a cloud service. 

This docker-compose network consisted of three containers to query ArcGIS API, store geocoded data, and perform computation on graph data structure; esri, mongo, and routefinder, respectively (see Figure \ref{docker-compose-network-diagram} and Appendix \ref{docker-images}).
\begin{figure}[!htb]
  \begin{center}
      \includestandalone[width=10cm]{tikz/docker-compose}
      \caption{Docker-compose network diagram.}\label{docker-compose-network-diagram}
    \end{center}
\end{figure}


\subsection{Computation}

When the project was started, it was thought that Spark could be used to perform graph processing\cite{SPARK}. Later on, it was decided that the graphs were not going to be large enough to have to worry about optimizing the processing. A graph data structure\cite{Agarwal} was still used for handing the data and computing routes.

%%%%%%%%%SECTION%%%%%%%%%
\chapter{Setup and Execution}
\section{Preprocessing}\label{preprocessing}
For the purposes of this and following sections refer to Figure \ref{ICS-Examples} as examples of ICS files. Even though the information gathered was readily available online, I have redacted addresses, links, summaries, and descriptions to avoid divulging any PII.
\begin{figure}[!htb]
  \begin{center}
    \begin{lstlisting}
      BEGIN:VCALENDAR
      VERSION:2.0
      BEGIN:VEVENT
      URL: REDACTED
      DTSTART:20190414T153000Z
      DTEND:20190414T170000Z
      SUMMARY: REDACTED
      DESCRIPTION: REDACTED
      LOCATION: REDACTED (location0)
      END:VEVENT
      END:VCALENDAR
    \end{lstlisting}
    \begin{lstlisting}
      BEGIN:VCALENDAR
      VERSION:2.0
      BEGIN:VEVENT
      URL: REDACTED
      DTSTART:20190413T150000Z
      DTEND:20190413T170000Z
      SUMMARY: REDACTED
      DESCRIPTION: REDACTED
      LOCATION: REDACTED (location1)
      END:VEVENT
      END:VCALENDAR
    \end{lstlisting}
    \caption{Example ICS files (locations 0 and 1).}\label{ICS-Examples}
    \end{center}
  \end{figure}

% \subsection{Geocoding} \label{geocoding}
Given a directory of $n$ ICS files (as per section \ref{E}) the data is parsed by the ICSParser (Appendix \ref{ICSParser}) and the address information is \emph{safely geocoded} (querying for existence in MongoDB, otherwise querying ArcGIS API for information) by MongoOps and a Flask REST endpoint (Appendices \ref{MongoOps} and \ref{Esri Flask App} respectively) \cite{Flask}. This process yields data like that shown in Figure \ref{location0_data}.
\begin{figure}[!htb]
  \begin{center}
    \begin{lstlisting}
      {'_id': ObjectId('5cabffe2671c85002d41afb3'), 'url': 'REDACTED', 'dtstart': '20190414T153000Z', 'dtend': '20190414T170000Z', 'summary': 'REDACTED', 'description': 'REDACTED', 'location': {'geometry': {'x': x_0, 'y': y_0, 'spatialReference': {'wkid': 4326, 'latestWkid': 4326}}, 'attributes': {'Loc_name': 'World', 'Status': 'M', 'Score': 100, ... 'X': x_0, 'Y': y_0, 'DisplayX': x_{d0}, 'DisplayY': y_{d0}, 'Xmin': x_{min0}, 'Xmax': x_{max0}, 'Ymin': y_{min0}, 'Ymax': y_{max0}, 'ExInfo': '', 'OBJECTID': 1}, 'address': <location0>(lower case, no punctuation)}, 'address_hash': sha1(location0)}
    \end{lstlisting}
    \caption{Final location JSON for the location0 ICS file.}\label{location0_data}
  \end{center}
\end{figure}


\begin{figure}[!htb]
  \begin{center}
    \begin{lstlisting}
      {'_id': ObjectId('5cad42f3671c850b358ab86b'), 'directions': [{'Time of day': '15:59:01', 'Direction text': 'Start at Location 0', 'Duration (min)': 0.0, 'Distance (miles)': 0.0}, {'Time of day': '15:59:01', 'Direction text': REDACTED, 'Duration (min)': 0.73, 'Distance (miles)': 0.4}, {'Time of day': '15:59:45', 'Direction text': REDACTED, 'Duration (min)': 7.33, 'Distance (miles)': 4.15}, {'Time of day': '16:06:21', 'Direction text': REDACTED, 'Duration (min)': 11.9, 'Distance (miles)': 8.26}, {'Time of day': '16:10:55', 'Direction text': REDACTED, 'Duration (min)': 14.04, 'Distance (miles)': 9.74}, {'Time of day': '16:13:03', 'Direction text': REDACTED, 'Duration (min)': 18.45, 'Distance (miles)': 13.29}, {'Time of day': '16:17:28', 'Direction text': REDACTED, 'Duration (min)': 19.67, 'Distance (miles)': 13.85}, {'Time of day': '16:18:41', 'Direction text': 'Finish at Location 1, on the right', 'Duration (min)': 19.67, 'Distance (miles)': 13.85}], 'directions_hash': sha1(location0 + location1), 'start': location0, 'stop': location1}
    \end{lstlisting}
    \caption{Directions information between location0 and location1.}\label{location0_location1_directions}
  \end{center}
\end{figure}

Gathering directions between locations follows a similar pattern. After the ICS files have been parsed into data that looks like Figure \ref{location0_data}, the same Flask app has another REST endpoint to accept two locations and return the directions, along with estimated durations as each step (see Figure \ref{location0_location1_directions}). At every point, when data has been geocoded (i.e. Figures \ref{location0_data} and \ref{location0_location1_directions}) that data is saved in an easily retrievable fashion via unique constructable hashes based on the location(s)' address(es)'s.

\section{Creating A Graph}
\subsection{Directions Matrix}
Once the ICS files have been processed, a \emph{direction matrix} is created. First, a verbose matrix is created by taking the addresses from the ICS files and querying the database for all $n \choose 2$ combinations of $\textsc{SHA-1}\left(\textsc{concat}\left(location_i, location_j\right)\right)$, where $0 <= i < j <= n-1$. Each entry of this matrix would look like that of Figure \ref{location0_location1_directions} and that is why a simplified form of the matrix is listed along side this matrix in the DirectionMatrix class (Appendix \ref{DirectionsMatrix}).

This verbose directions matrix is entirely usable, but would require the code also be verbose when gathering the travel time when constructing the graph and assigning edge weights. Hence, a simplified matrix that looks like Figure \ref{simplified directions array} is created as a refinement of the original data.

\begin{figure}[!htb]
  \begin{lstlisting}
    [{'_id': ObjectId('5cad42f3671c850b358ab86b'), 'url': REDACTED, 'dtstart': '20190414T153000Z', 'dtend': '20190414T170000Z', 'summary': REDACTED, 'description': REDACTED, 'location': {'geometry': {'x': x_0, 'y': y_0, 'spatialReference': {'wkid': 4326, 'latestWkid': 4326}}, 'attributes': {'Loc_name': 'World', 'Status': 'M', 'Score': 100, ... 'X': x_0, 'Y': y_0, 'DisplayX': x_{d0}, 'DisplayY': y_{d0}, 'Xmin': x_{min0}, 'Xmax': x_{max0}, 'Ymin': y_{min0}, 'Ymax': y_{max0}, 'ExInfo': '', 'OBJECTID': 1}, 'address': REDACTED}, 'address_hash': sha1(location0), 'durations': [[1, 13.85]]}
 {'_id': ObjectId('5cac003a671c85002d41afb9'), 'url': REDACTED, 'dtstart': '20190413T150000Z', 'dtend': '20190413T170000Z', 'summary': REDACTED 'description': 'REDACTED, 'location': {'geometry': {'x': x_1, 'y': y_1, 'spatialReference': {'wkid': 4326, 'latestWkid': 4326}}, 'attributes': {'Loc_name': 'World', 'Status': 'M', 'Score': 100, ... 'X': x_1, 'Y': y_1, 'DisplayX': x_{d1}, 'DisplayY': y_{d1}, 'Xmin': x_{min1}, 'Xmax': x_{max1}, 'Ymin': y_{min1}, 'Ymax': y_{max1}, 'ExInfo': '', 'OBJECTID': 1}, 'address': REDACTED},, 'address_hash': sha1(location1), 'durations': [[0, 14.15]]}]
  \end{lstlisting}
  \caption{Simplified Directions Array (Matrix).}\label{simplified directions array}
\end{figure}

 \subsection{Open House Graph}
 With the directions matrix derived, a graph can now be constructed and routes can be discovered that direct users to a maximum number of houses. Looking at Figure \ref{simplified directions array} we can see that edge data has been defined by the \textsf{durations} key-value pairing, the start and stop times are included; all that is left is to do one last transformation to what the graph expects and create the graph (Figure \ref{last refinement}).
 \begin{figure}[!htb]
   \begin{lstlisting}
for i in range(len(sdm)):
  start = str(int(sdm[i]['dtstart'][9:-3])-400)
  start_minutes = int(start[:-2])*60 + int(start[-2:])
  end = str(int(sdm[i]['dtend'][9:-3])-400)
  end_minutes = int(end[:-2])*60 + int(end[-2:])
  sdm[i]['start_minutes'] = start_minutes
  sdm[i]['end_minutes'] = end_minutes

vertices = []
V = None
for i in range(len(sdm)):
    V = {'ID' : i, 
            'start' : sdm[i]['start_minutes'], 
            'end' : sdm[i]['end_minutes'], 
            'edges' : sdm[i]['durations'],
            'address_hash' : sdm[i]['address_hash'],
            'address' : sdm[i]['location']['address']}
    vertices += [V]
ohg = OpenHouseGraph(vertices)
   \end{lstlisting}
   \caption{Last Refinement and Graph Construction.}\label{last refinement}
  \end{figure}

The \textsf{ID} of a given vertex (as seen in second loop of Figure \ref{last refinement}), corresponds to the $0^{th}$ index of an \textsf{edge} (\textsf{durations} in the directions matrix). So that data from Figure \ref{simplified directions array} will looks like Figure \ref{vertex edge relation}, meaning that it will take $13.85$ minutes travel from the house $0$ to house $1$, and $14.15$ in the other direction.
\begin{figure}[!htb]
  \begin{lstlisting}
    [{'ID': 0 'durations': [[1, 13.85]], ...}, 
    {'ID': 1 'durations': [[0, 14.15]], ...}]
  \end{lstlisting}
  \caption{Vertex-Edge Relation.}\label{vertex edge relation}
\end{figure}

The \textsf{Graph} constructor (see Appendix \ref{OpenHouseGraph}) takes this information and stores the edges as [[0, 1, 13.85], [1, 0, 14.15]], and stores the rest of the JSON as the vertex information. To help keep the explanation as general as possible, the following notation will be used:
\begin{itemize}
  \item vertices will be referred to as $v_i$,
  \item the start and stop time of open houses belong to a vertex will be denoted $t_{i0}$ and $t_{i1}$ respectively,
  \item edges from $v_i$ to $v_j$ will be denoted $e_{ij}$.
  \item values from edges $e_{ij}$ can be accessed as they would be in an array. \ie $e_{01}[2] = 13.85$ (Figure \ref{vertex edge relation}).
\end{itemize}

Figure \ref{last refinement} shows some shorthand that I wanted to use. Instead of working with a built in time API, I assumed that the day did not matter. All that needed to work with time was to convert the time to a base-10 numbering system (minutes since midnight), This allows computation in the graph to use duration in minutes returned by the ArcGIS API, and just keep a running tally of the time (scoped to a recursive function call) when figuring out when one would arrive at a given house.
 
\subsection{Finding Routes}
\subsubsection{Starting Vertices}
To start the search of paths, a for-loop is used to select starting vertices to enter the graph on. The program is written such that when we arrive at the first vertex, $v_i$, that the we arrive as soon as the open house starts, $t_{i0}$. $t_{i0}$ will be used as the initializing value for a time tracking variable, $T$, and $v_i$ is used to start the current paths' set of visited locations, $V$, and will later populate the $trip$ variables that contains the possible trips given the arbitrary starting point $v_i$.
\begin{figure}[!htb]
  \begin{center}
      \includestandalone[width=10cm]{tikz/trivial-graph}
      \caption{A trivial case of the Open House Graph.}\label{trivial-graph}
    \end{center}
\end{figure}

\subsubsection{Discoving Routes}
Now that we are at $v_i$ at time $T$ and having visited $V$, the \textsf{visit\_next} function in \textsf{OpenHouseGraph} follows this pattern
\begin{enumerate}
  \item Gather acyclic edges and iterate on them,
  \item spend 30 minutes (default value) at the current house and assign that to a departure time variable ($T_d := T + 30$),
  \item determine the what the arrival time at $v_j$ would be and assign that to an arrival time variable ($T_a := T_d + e_{ij}[2]$),
  \item determine if the open house has opened and determine if it has closed,\\
  \hspace*{0.5em} Determining both values allows us to perform additional checks on the time.
    \begin{itemize}
      \item If the open house has \textbf{not opened}, we can tell the function to set the arrival time to the start of the open house ($T_a := t_{j0}$).
      \item If the open house is \textbf{not closed}, we can tell the function that the arrival time is correct and does not need updating.
      \item If the open house is \textbf{closed} (or in the unlikely case that the time is in some other state), we can tell the function to set the arrival time to $-1$ ($T_a := -1$).
    \end{itemize}
    \hspace*{0.5em} If $T_a > 0$, then then function is allowed to proceed.
  \item $v_j$ is added to a list of visited $V$ ($V := [\cdots , v_i, v_j]$, where $V$ previously equaled $[\cdots , v_i]$),
  \item finally, a recursive call is made to the \textsf{visit\_next} function to start the pattern all over again. Once no valid acyclic edges exist, 
    \begin{itemize}
      \item the function will return its current $V$ as long as $|V| > 1$; adding the value of $V$ of a deeper recursive layer to the $trip$ variable one level higher. 
      \item Otherwise \textsf{visit\_next} will return all the $trip$s it has discovered back to the user.
    \end{itemize}
\end{enumerate}

\subsubsection{Evaluating The Results}
It is at this point where I called my development to a halt. With our trivial case above, the scenario returns $[[0,1], [1,0]]$. This a worst case scenario for systems with more vertices, but would most likely only occur with $4$ or less houses (assuming a $30$ minute stay at each house). With larger graphs like that of Figure \ref{seven-houses}, the returned scenario often times looks like Figure \ref{seven-houses-results}.
\begin{figure}[!htb]
  \begin{center}
    \includestandalone[width=7.5cm]{tikz/seven-houses}
    \caption{Open House Graph containing seven houses.}\label{seven-houses}
  \end{center}
\end{figure}
\begin{figure}
  \begin{center}
    $[[0, 1, 2, 3, 4, 5, 6], [0, 1, 2, 3, 4, 6, 5], [0, 1, 2, 3, 4, 6], [0, 1, 2, 3, 4, 5],$\\ $\cdots, [0, 2, 4, 5, 6], \cdots, [0, 4, 6], [2, 0, 1, 3, 5, 4, 6], \cdots [6, 5], \cdots]$
  \end{center}
  \caption{Simulated results of graph of seven vertices.}\label{seven-houses-results}
\end{figure}

The sheer number of results may seem intimidating, but it is a simple task a finding the max length of the trips and then displaying a trimmed down version. In the sample results of Figure \ref{seven-houses-results}, we can see that it is possible to visit all seven houses in a couple of different ways. This will not always be the case because of the limitations of travel and when the houses are open to the public. I tried to stress the system with $10$ open houses and the program always completes its task in less than $0.6$ seconds.

\chapter{Conclusions and Future Work}
\section{Conclusions}
\subsection{Reflection}
In the beginning of this project, I wanted to use different higher level graph theory concepts to try to solve the problem of routing the user to different open houses, rather than via brute force. Though after some time I decided to get answers before trying to dive too deeply into what \textit{could} be done. After getting the methodology down, I worked out some scenarios by hand and went house hunting. After confirming that I could find a route (a route in which I found the house I now own), I proceeded to implement the program that is being presented here.

The methodology of routing the user to house is fairly sound, though after nailing down the 30 minute stay as a default time to stay at a house, I asked my realtor how long people usually stayed at an open house and he said it was more like 10 - 15 minutes. A change to how much time the user would potentially stay at a house can be changed easily, but I did not concern myself too much with that because the core logic of the problem was completed and I figured assuming the user stayed a house longer than normal would allow for human error to occur throughout the day.

\subsection{Justification}
I would still like to look into using methods other than the brute force to solve this problem, but for routing a user to a small number of open houses it might not be necessary to do anything more than brute force. Open houses are usually open from about 10am until 5pm; $7$ hours. If travel time is elimatinated ($e_{ij} = 0, \forall i,j$) and one spends on average $30$ minutes at each house, then the max recursive depth of the \textsf{visit\_next} function is $14$. Additionally, an interview with David W. Jansing brought to my attention that with how bounded this particular problem is, more complex functions may potentially require more time to set up than brute force needs to run\cite{jansing_jansing_2019}.

In an attempt to stress the program, I have requested an export of open house data in San Antonio, TX, but I foresee the traffic of a large city keeping the number potential routes low (many short routes may be returned, but will be ignored for larger ones).

\section{Future Work}
\hspace*{-2.5em} The future work of this project comes down to some of the stretch goals I provided myself:
\begin{itemize}
  \item implement other methods of traversing the graph,
  \item provide a more user friendly way to ingest data,
  \item and supply a front end that users could interact with and receive detailed information from.
\end{itemize}

\hspace*{-2.5em} Other things that may be worked on in the future are:
\begin{itemize}
  \item clean up the information stored in the database. Right now, if you do not clear the database from week to week and you query a house that was open previously, you will receive the hours of the last week.
  \item And there is an issue with character encoding with the ICSParser. The issue was ignored during the scope of this project, but if this were to be serves up to a client, then it would not be good to just through out whatever is not understood.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                   STOP REMOVING HERE :-)                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{plain}
% change the following to whatever your .bib filename is (minus the ".bib")
\bibliography{Open-House-Route-Planner}


\begin{appendix}
    \chapter*{Appendices\addcontentsline{toc}{chapter}{Appendices}}
    \begin{singlespace}
        
        % You should have as many chapters as you need organized into separate files.
        \input{appendix.tex}
        
    \end{singlespace}
\end{appendix}

\end{document}

