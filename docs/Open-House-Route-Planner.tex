% This is an example manuscript for the SUNY Poly style options
%       sunypoly_ms.sty (Masters Thesis)

\documentclass[letterpaper,11pt]{report}
\usepackage{sunypolyms}       % For Master's papers
\usepackage{ulem}       % underlining on style-page; see \normalem below
\usepackage{url}	% support for hyperlinks, especially in bibliography
%  packages
\usepackage{amssymb, amsmath, amsthm, enumerate, graphicx, multirow, float, color, xcolor}
\usepackage{tikz, standalone}
\usetikzlibrary{arrows}
\usetikzlibrary{graphs,quotes}
\usepackage[hidelinks]{hyperref}
\hypersetup{breaklinks=true}
\urlstyle{same}
\usepackage{cite}

%  theorems, corollaries, etc.
\theoremstyle{definition}
\newtheorem{thm}{Theorem}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}

\theoremstyle{definition}
\newtheorem*{example}{Example}
\newtheorem{dfn}[thm]{Definition}

\renewcommand{\qedsymbol}{\vrule height 5pt width 4pt depth -1pt}

% spacing shortcuts
\def\skip{\vspace{10 pt}}
\def\medskip{\vspace{15 pt}}

% text shortcuts
\def\ie{{i.e.,}\ }
\def\eg{{e.g.,}\ }
\def\bbar#1{\overline{#1}}

%  set shortcuts
\def\ket#1{\big|{#1}\big>}
\def\bra#1{\big<{#1}\big|}

\def\red#1{\textcolor{red}{#1}}

% number theory shortcuts
\def\divides{\big |}
\def\gcd#1#2{\textrm{gcd}({#1},{#2})}
\def\ord#1{|{#1}|}

% logic shortcuts
\def\iff{\Leftrightarrow}
\thispagestyle{empty}

% standard math packages
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{scrextend}
\usepackage{tikz}
\usetikzlibrary{arrows, shapes, plothandlers}
\usepackage{tikz}
\usepackage{tikzscale}
\usepackage{ragged2e}

\usepackage{hyperref}
\usepackage{url}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}

\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother

% Another Code Snippet displayer used to colorize yml properly
% UNCOMMENT WHEN BEFORE COMMITTING OR PRINTING
\usepackage{minted}

\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\scriptsize\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breakatwhitespace=true,
  tabsize=3,
  breaklines=true,
  literate={\-}{}{0\discretionary{-}{}{-}},
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}

% Phil Parker's DGS packages, some modified
% \usepackage{remexpp,pprroof,dgstpp}

% other packages
\usepackage{setspace}
%\usepackage{hyperref,color}

% "fancy" font
\usepackage{fourier}
\usepackage[T1]{fontenc}
   
% make reference header the right font size
% \renewcommand\refname{\Large References}
   
% theorems, remarks, etc using Phil Parker's "remexpp.sty"
% \newtheorem{theorem}{Theorem}[section]
% \newtheorem{prop}[theorem]{Proposition}
% \newtheorem{lemma}[theorem]{Lemma}
% \newtheorem{claim}[theorem]{Claim}
% \newtheorem{corollary}[theorem]{Corollary}
% \newremark{definition}[theorem]{Definition}
% \newremark{example}[theorem]{Example}
% \newremark{remark}[theorem]{Remark} 

% make rsfs, TeX \cal, and Euler script *all* available
\usepackage{mathrsfs}
\let\rscr=\mathscr
\let\mathscr=\relax
\let\mcal=\mathcal
\usepackage{eucal}
\let\escr=\mathcal
\let\mathcal=\relax

% commutative diagrams with XY-pic
\usepackage[all]{xy}
\SelectTips{cm}{}

\arraycolsep .2em
   
% new commands
\renewcommand{\a}{\alpha}
\newcommand{\Aut}[1]{\textrm{Aut}(#1)}
\newcommand{\B}{\rscr{B}}
\newcommand{\br}[2]{\left[#1,#2\right]}
\newcommand{\bre}{\br{\ }{\,}}
\newcommand{\ddg}{\ddot{\g}}
\newcommand{\dg}{\dot{\g}}
\newcommand{\DGS}{D{\kern-.375em}G{\kern-.2em}S}
\newcommand{\ds}{\oplus}
\newcommand{\eB}{\escr{B}}
\newcommand{\eH}{\escr{H}}
\newcommand{\eI}{\escr{I}}
\newcommand{\eV}{\escr{V}}
\newcommand{\g}{\gamma}
\newcommand{\G}{\Gamma}
\newcommand{\h}{\lal{h}}
\renewcommand{\H}{\rscr{H}}
\newcommand{\hp}{\h_{2p + 1}}
\newcommand{\iso}{\cong}
\newcommand{\lag}{\mathfrak{g}}
\newcommand{\lal}[1]{\mathfrak{#1}}
\newcommand{\n}{\lal{n}}
\newcommand{\pplus}{+\mspace{-10 mu}+}
\newcommand{\R}{\mathbb{R}}
\newcommand{\rS}{\rscr{S}}
\renewcommand{\span}[1]{[\mspace{-3.25 mu}[ #1 ]\mspace{-3.25 mu}]}
\newcommand{\surj}{\rightarrow\kern-.82em\rightarrow}
\newcommand{\tQ}{\widetilde{Q}}
\renewcommand{\v}{\lal{v}}
\newcommand{\V}{\rscr{V}}
\newcommand{\z}{\lal{z}}
%%Alex's defined commands%%
\newcommand{\adx}{ad$_x$ }
\newcommand{\ady}{ad$_y$ }
\newcommand{\adz}{ad$_z$ }
\newcommand{\fj}{\mathfrak{j}}
\newcommand{\fg}{\mathfrak{g}}
\newcommand{\fz}{\mathfrak{z}}
\newcommand{\fv}{\mathfrak{v}}
\newcommand{\fh}{\mathfrak{h}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\FF}{\mathbb{F}}



% Adjust placement of text frame to match your software and hardware.
% Usually 1.5in on left, 1in on right and bottom.  You may not need
% to uncomment this section.  Home printing systems are notorious for
% incorrectly placed margins due to paper loading and/or slipping
% problems
%
%\addtolength{\oddsidemargin}{.2in}
%    \setlength{\evensidemargin}{\oddsidemargin}
%\addtolength{\topmargin}{-.1in}


% May want theorems numbered by chapter
\newtheorem{theorem}{Theorem}[chapter]

% Put the title, author, and date in. 
\title{Open House Route Planner}
\author{Alexander Jansing}
\date{\today} % date is the date of graduation

% List previous degrees here, one \previousdegree for each degree.
%\previousdegree{M.A., University of Nebraska--Lincoln, 1984}
\previousdegree{B.S., SUNY Oswego, 2015}

% Put the Thesis Adviser here. 
\advisor{Jorge Novillo}


% Put the committee here (including the adviser), one \professor for each. 
% The advisor must be SECOND!!!, and the dean must be LAST!!!.
\professor{PLACEHOLDER\\
Professor\\
Department of Computer Science}

\professor{Jorge Novillo\\
Professor \\
Department of Computer Science}

\professor{PLACEHOLDER\\
Professor \\
Department of Computer Science}

\professor{PLACEHOLDER\\
Dean\\
College of Engineering}



% Information for style-page
% Note: Due to the way underlining is handled, any "extra" braces here will
% create a box which cannot be broken across lines. The \style argument below
% shows how emphasis should be done.

\style{Journal of Approximation Theory (together with the style known as
``sunypolyms'').  Bibliography follows van Leunen's {\it A} {\it Handbook}
{\it for} {\it Scholars}.}


\software{The document preparation package \TeX{} (specifically \LaTeX2e)
together with the style-file {\tt sunypolyms.sty}.}



\begin{document}

% Uncomment the "nocite" line to have all entries in your bibliography listed,
% regardless of whether they were cited.  This is often helpful in discovering
% you had not referenced a source you intended, especially if, like me,
% you add useful sources to your bibliography file as you discover them.  If
% you don't add sources to your bibliography until you write text that cites
% them, you may never need this line.
%
\nocite{*}

\begin{romanpages}      % roman-numbered pages 
    \ApprovalPage   % May comment-out until final version.
    \TitlePage 
    \CopyrightPage  % Should do nothing for Ph.D., if the degree is ever offered
    
    % This should be a paragraph-style history of your academic work and
    % industry efforts that may have contributed to your reaching this
    % stage in your academic career.  
    %
    % Note that this is a special chapter style that must begin and end 
    % the "vita" LaTeX environment.
    %
    \input{vita.tex}
    
    % This should be a very high level overview of the novel work presented
    % in your manuscript.  Experiments should be outlined with the utmost brevity
    % and only their most compelling results revealed.  Often the results
    % identified here will lack numeric values which are saved for the Introduction
    % chapter. 
    %
    % Note that this is a special chapter style that must begin and end 
    % the "abstract" LaTeX environment.
    %
    \input{abstract.tex}
    
    % Acknowledge and dedicate you work to whomever you wish.  It is common to
    % identify those who significantly advised your work by name and at least 
    % recognize your advisory committee as a whole.  This chapter is personal, 
    % however, so a simple "R.I.P. Johhny Cash" is completely acceptable.
    %
    % Note that this is a special chapter style that must begin and end 
    % the "acknowledgments" LaTeX environment.
    %
    \input{acknowledgments.tex}
    
    \StylePage
    \tableofcontents
    
    % comment either of the following lines should your manuscript contain no 
    % figures or tables
    %
    \listoffigures
    \listoftables
    
\end{romanpages}        % All done with roman-numbered pages


\normalem       % Make italics the default for \em


% Introduction ((((( required! )))))
%
%\input{introduction.tex}

% Related work ((((( required! )))))
%
%\input{related_work.tex}

% Statement of the problem
%
%\input{problem.tex}

% How you attempted to solve the problem
%
%\input{solution.tex}

% Implementations of your solution
%
%\input{implementations.tex}

% How did you determine whether you solved the problem
%
%\input{experiments.tex}

% What ascpects of the problem did you solve or not solve? ((((( !REQUIRED! ))))) 
% What are the anticipated benefits of this? ((((( !REQUIRED! ))))) 
%
%\input{conclusions.tex}

% NEXT STEPS SHOULD SOMEONE CONTINUE THIS WORK ((((( required! )))))
%
%\include{future_work.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% REMOVE THIS SECTION WHEN PREPARING YOUR OWN MANUSCRIPT AND WRITE %
%          THE FILES NEEDED TO MEET THE ABOVE ORGANIZATION         % 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Open House Routing Planner}
\subsection{Motivation}
I have been looking for houses. When I add open houses to my Google Calendar, I am able to request direction to whatever house is open next in time, but I was thinking

Over the last year, I had been looking for a house and was trying to visit as many open houses as I could. So the question became, \emph{``What if two houses are significantly far apart, open at similar times, and there are other houses in each of their respective neighborhoods that open at different times? Is there a way I can plan my day of house hunting so that I can attend all of the open houses?''} The answer to this question is, ``yes, within reason.''

\subsection{Objective}
Given a series of open houses the application should find routes that will allow the user to visit the maximum number of open houses given the constraints of \emph{travel time} and \emph{when the open houses are open}.

After phrasing stating the problem, the problem was divided up into several part:
\begin{itemize}
  \item where the houses were with respect to each other,
  \item when the open houses were,
  \item and try to determine the path I needed to take to visit as many open houses as possible.
\end{itemize}

I will describe how each of these tasks were accomplished and what other work needed to be done to facilitate that work.

%%%%%%%%%SECTION%%%%%%%%%

\section{Requirements}
As with most projects, a bit of legwork is involved before even starting the main problem. Before routes can be derived from the data, we need to know
\begin{itemize}
  \item what kind of data the system will accept,
  \item what kind of ETL (Extraction, Transformation, and Loading) processes will need to occur,
  \item if/how there data will be cached,
  \item what infrastructure can we set up to support these requirements,
  \item and how might we will we compute routes?
\end{itemize}

\subsection{ETL}
As for the first three points, the following describe what kind of data the program accepts, its transformation, and how there data is cached.

\subsubsection{Extraction}\label{E}
Data extraction was performed manually as it seems that many realestate sites did not want to hand over data programatically; or if they did the purchase of an API key was required. The data used for this project was sourced from Trulia\cite{Trulia} in the form of ICS files\cite{ICS}.

\subsubsection{Transformation}\label{T}
Open House data is typically provided with in a human readable format with an address written like ``100 Seymour Ave, Utica, NY 13502'' and times provided in the form "10AM to 12PM." These forms of data need to be handled somehow. Luckily, when downloading calendar data the time data comes in ISO 8601 Notation (\emph{\ie} yyyymmddThhmmssZ).

That just leaves the address to be \emph{geocoded}; the process of converting addresses to a coordinate system. The ArcGIS Developer API provides an easy way to geocode address data. This process will be described in the section \ref{preprocessing} along with all the other transformations required to consistently gather and use data.
 
\subsubsection{Loading}\label{L}
To avoid having to query the ArcGIS API repeated and spending the credits that was required\cite{ArcGIS}, the data is stored in a MongoDB instance. This not only helps the program be more economically efficient, but cuts down on latency during testing and future delivery.

\subsection{Infrastructure}
Docker is a container platform that helps facilitate rapid prototyping, development, and compartmentalization of development of projects \cite{DOCKER}. Docker, and subsequently docker-compose\cite{DC}, was used on this project to set up network on systems that could easily be deployed on a cloud service. 

This docker-compose network consisted of three containers to query ArcGIS API, store geocoded data, and perform computation on graph data structure; esri, mongo, and routefinder, respectively (see Figure \ref{docker-compose-network-diagram} and Appendix \ref{docker-images}).
\begin{figure}[!htb]
  \begin{center}
      \includestandalone[width=9cm]{tikz/docker-compose}
      \caption{Docker-compose network diagram.}\label{docker-compose-network-diagram}
    \end{center}
\end{figure}


\subsection{Computation}

When the project was started, it was thought that Spark could be used to perform graph processing\cite{SPARK}. Later on, it was decided that the graphs were not going to be large enough to have to worry about optimizing the processing. A graph data structure was still used for handing the data when the time came to computing routes\cite{Agarwal}. The vertices were given IDs, addresses, start and end times, and edges with weights.

%%%%%%%%%SECTION%%%%%%%%%
\section{Preprocessing}\label{preprocessing}
For the purposes of this and following sections refer to Figure \ref{ICS-Examples} as examples of ICS files. Even though the information gathered was readily available online, I have redacted addresses, links, summaries, and descriptions to avoid divulging any PII.
\begin{figure}[!htb]
  \begin{center}
    \begin{lstlisting}
      BEGIN:VCALENDAR
      VERSION:2.0
      BEGIN:VEVENT
      URL: REDACTED
      DTSTART:20190414T153000Z
      DTEND:20190414T170000Z
      SUMMARY: REDACTED
      DESCRIPTION: REDACTED
      LOCATION: REDACTED (location1)
      END:VEVENT
      END:VCALENDAR
    \end{lstlisting}
    \begin{lstlisting}
      BEGIN:VCALENDAR
      VERSION:2.0
      BEGIN:VEVENT
      URL: REDACTED
      DTSTART:20190413T150000Z
      DTEND:20190413T170000Z
      SUMMARY: REDACTED
      DESCRIPTION: REDACTED
      LOCATION: REDACTED (location2)
      END:VEVENT
      END:VCALENDAR
    \end{lstlisting}
    \caption{Example ICS files (locations 1 and 2).}\label{ICS-Examples}
    \end{center}
  \end{figure}

% \subsection{Geocoding} \label{geocoding}
Given a directory of $n$ ICS files (as per section \ref{E}) the data is parsed by the ICSParser (\ref{code}) and the address information is \emph{safely geocoded} (querying for existence in MongoDB, otherwise querying ArcGIS API for information) by MongoOps and a Flask REST endpoint \cite{Flask}. This process yeilds data like that shown in Figure \ref{location1_data}.
\begin{figure}[!htb]
  \begin{center}
    \begin{lstlisting}
      {'_id': ObjectId('5cabffe2671c85002d41afb3'), 'url': 'REDACTED', 'dtstart': '20190414T153000Z', 'dtend': '20190414T170000Z', 'summary': 'REDACTED', 'description': 'REDACTED', 'location': {'geometry': {'x': x_1, 'y': y_1, 'spatialReference': {'wkid': 4326, 'latestWkid': 4326}}, 'attributes': {'Loc_name': 'World', 'Status': 'M', 'Score': 100, ... 'X': x_1, 'Y': y_1, 'DisplayX': x_d, 'DisplayY': y_d, 'Xmin': x_min, 'Xmax': x_max, 'Ymin': y_min, 'Ymax': y_max, 'ExInfo': '', 'OBJECTID': 1}, 'address': <location1 (lower case, no punctuation)>}, 'address_hash': <hash of location1>}
    \end{lstlisting}
    \caption{Final location JSON for the location1 ICS file.}\label{location1_data}
  \end{center}
\end{figure}


\begin{figure}
  \begin{center}
    \begin{lstlisting}
      {'_id': ObjectId('5cad42f3671c850b358ab86b'), 'directions': [{'Time of day': '15:59:01', 'Direction text': 'Start at Location 1', 'Duration (min)': 0.0, 'Distance (miles)': 0.0}, {'Time of day': '15:59:01', 'Direction text': REDACTED, 'Duration (min)': 0.73, 'Distance (miles)': 0.4}, {'Time of day': '15:59:45', 'Direction text': REDACTED, 'Duration (min)': 7.33, 'Distance (miles)': 4.15}, {'Time of day': '16:06:21', 'Direction text': REDACTED, 'Duration (min)': 11.9, 'Distance (miles)': 8.26}, {'Time of day': '16:10:55', 'Direction text': REDACTED, 'Duration (min)': 14.04, 'Distance (miles)': 9.74}, {'Time of day': '16:13:03', 'Direction text': REDACTED, 'Duration (min)': 18.45, 'Distance (miles)': 13.29}, {'Time of day': '16:17:28', 'Direction text': REDACTED, 'Duration (min)': 19.67, 'Distance (miles)': 13.85}, {'Time of day': '16:18:41', 'Direction text': 'Finish at Location 2, on the right', 'Duration (min)': 19.67, 'Distance (miles)': 13.85}], 'directions_hash': hash of the concatenation of location1 and location2, 'start': location1, 'stop': location2}
    \end{lstlisting}
    \caption{Directions information between location1 and location2.}\label{location1_location2_directions}
  \end{center}
\end{figure}

Gathering directions between locations follows in a similar manner. After the $n$ ICS files have been parsed into data that looks like Figure \ref{location1_data}, the same Flask app has another REST endpoint to accept two locations and return the directions, along with estimated durations as each step (see Figure \ref{location1_location2_directions}).

And at every point, when data has been geocoded (i.e. Figures \ref{location1_data} and \ref{location1_location2_directions}) that data is saved in an easily retrievable fashion via unique constructable hashes based on the location(s)' address(es)'s.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                   STOP REMOVING HERE :-)                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{plain}
% change the following to whatever your .bib filename is (minus the ".bib")
\bibliography{Open-House-Route-Planner}


\begin{appendix}
    \chapter*{Appendices\addcontentsline{toc}{chapter}{Appendices}}
    \begin{singlespace}
        
        % You should have as many chapters as you need organized into separate files.
        \input{appendix.tex}
        
    \end{singlespace}
\end{appendix}

\end{document}

